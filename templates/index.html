<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Photo Map</title>
    <style>
        #map { width: 100%; height: 90vh; }
        .marker-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
    </style>
    <script src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js"></script>
</head>
<body>
<div id="map"></div>
<script>
const photos = {{ photos|tojson }};

mapkit.init({
    authorizationCallback: function(done) {
        // Provide your MapKit JS token
        done(localStorage.getItem('MAPKIT_JWT') || 'YOUR_MAPKIT_TOKEN');
    }
});

const map = new mapkit.Map('map');
map.region = new mapkit.CoordinateRegion(new mapkit.Coordinate(0,0), new mapkit.CoordinateSpan(140,140));

function createAnnotation(photo) {
    const coord = new mapkit.Coordinate(photo.lat, photo.lon);
    const img = document.createElement('img');
    img.src = '/' + photo.file;
    img.className = 'marker-img';
    const annotation = new mapkit.MarkerAnnotation(coord, {
        glyph: img,
        title: photo.file
    });
    annotation.addEventListener('select', () => {
        const popup = window.open(img.src, '_blank');
    });
    return annotation;
}

const annotations = photos.map(createAnnotation);
map.addAnnotations(annotations);

</script>
</body>
</html>
